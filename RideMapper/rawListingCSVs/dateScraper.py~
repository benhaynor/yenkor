import nltk
import datetime
import re

DAYRES = ['mon','tue','wed','thu','fri','sat','sun']
TODAYRE = 'today'
TOMORROWRE = 'tomorrow'
DATERE = '(\d{1,2})/(\d{1,2})'
MONRE = '(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)([^ ]*) (\d{1,2})'
MONRE2 = '(the)( )(\d{1,2})(th|nd)'
             


def scrapeDate(row):
    '''
    Takes as an input a rows from a raw CSV file.
    As an output, gives the best guess of the departure date
    '''
    cldate = row[4]
    todayYear = row[4][0:4]
    todayMonth = row[4][5:7]
    todayDay = row[4][8:10]
    title = nltk.word_tokenize(row[0])
    body = nltk.word_tokenize(row[3])
    joined = title + body
    line = row[0] + ' ' + row[3]

    m = re.search(DATERE,line)
    if m:
        try:
            return '%s%02d-%02d%s' % (row[4][:5],int(m.groups()[0]),int(m.groups()[1]),row[4][10:])
        except ValueError:
            pass
            #2012-11-17T21:31:54-05:00
    
    m = re.search('asap')
    if m:
        return cldate

    m = re.search('(today)',line)
    if m:
        return cldate

    m = re.search('(tomorrow)',line)
    if m:
        return '%s%02d-%02d%s' % (row[4][:5],int(todayMonth),int(todayDay),row[4][10:])
        return 'hey'

    

if __name__ == "__main__":
    import readCSV
    tb = readCSV.TandB('boston2012-11-1808:46:11.720122.csv')
    for i in range(1,98):
        print 'Scanning row %d' % i
        res = scrapeDate(tb.rows[i])
        if res:
            print res
